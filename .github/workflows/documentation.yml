name: Build, test and generate docs
on: [push]

jobs:
  # Build job
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout current branch
        uses: actions/checkout@v3
      # - name: Checkout master branch
      #   uses: actions/checkout@v3
      #   with:
      #     ref: master
      #     path: master
      # - name: Checkout preview branch
      #   uses: actions/checkout@v3
      #   with:
      #     ref: preview
      #     path: preview
      - name: Setup Pages
        uses: actions/configure-pages@v2
      - name: Build master with Jekyll
        uses: actions/jekyll-build-pages@v1
        with:
          source: 'docs'
          destination: ./_site
      # - name: Build preview with Jekyll
      #   uses: actions/jekyll-build-pages@v1
      #   with:
      #     source: ./preview
      #     destination: ./_site/_preview
      # - name: Substitutions in _preview site        
      #   run: sudo /bin/bash ./generate_preview_site.sh
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v1

  # Publication job
  publish:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v1

  # docs:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v1
  #     - run: mkdir build
  #     - uses: mattnotmitt/doxygen-action@v1.9.5
  #       with:
  #        # working-directory: 'dtwc/'
  #         doxyfile-path: 'docs/Doxyfile'
  #     - name: Deploy Docs
  #       uses: peaceiris/actions-gh-pages@v3
  #       with:
  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         publish_branch: gh-pages
  #         publish_dir: ./build/Doxygen
  # jekyll:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: ðŸ“‚ setup
  #       uses: actions/checkout@v2

  #       # include the lines below if you are using jekyll-last-modified-at
  #       # or if you would otherwise need to fetch the full commit history
  #       # however this may be very slow for large repositories!
  #       # with:
  #       # fetch-depth: '0'
  #     - name: ðŸ’Ž setup ruby
  #       uses: ruby/setup-ruby@v1
  #       with:
  #         ruby-version: 2.7

  #     - name: ðŸ”¨ install dependencies & build site
  #       uses: limjh16/jekyll-action-ts@v2
  #       with:
  #         enable_cache: true
  #         ### Enables caching. Similar to https://github.com/actions/cache.
  #         #
  #         # format_output: true
  #         ### Uses prettier https://prettier.io to format jekyll output HTML.
  #         #
  #         # prettier_opts: '{ "useTabs": true }'
  #         ### Sets prettier options (in JSON) to format output HTML. For example, output tabs over spaces.
  #         ### Possible options are outlined in https://prettier.io/docs/en/options.html
  #         #
  #         # prettier_ignore: 'about/*'
  #         ### Ignore paths for prettier to not format those html files.
  #         ### Useful if the file is exceptionally large, so formatting it takes a while.
  #         ### Also useful if HTML compression is enabled for that file / formatting messes it up.
  #         #
  #         jekyll_src: 'docs/'
  #         ### If the jekyll website source is not in root, specify the directory. (in this case, sample_site)
  #         ### By default, this is not required as the action searches for a _config.yml automatically.
  #         #
  #         # gem_src: sample_site
  #         ### By default, this is not required as the action searches for a _config.yml automatically.
  #         ### However, if there are multiple Gemfiles, the action may not be able to determine which to use.
  #         ### In that case, specify the directory. (in this case, sample_site)
  #         ###
  #         ### If jekyll_src is set, the action would automatically choose the Gemfile in jekyll_src.
  #         ### In that case this input may not be needed as well.
  #         #
  #         # key: ${{ runner.os }}-gems-${{ hashFiles('**/Gemfile.lock') }}
  #         # restore-keys: ${{ runner.os }}-gems-
  #         ### In cases where you want to specify the cache key, enable the above 2 inputs
  #         ### Follows the format here https://github.com/actions/cache
  #         #
  #         # custom_opts: '--drafts --future'
  #         ### If you need to specify any Jekyll build options, enable the above input
  #         ### Flags accepted can be found here https://jekyllrb.com/docs/configuration/options/#build-command-options
  #     - name: ðŸš€ deploy
  #       uses: peaceiris/actions-gh-pages@v3
  #       with:
  #         github_token: ${{ secrets.GITHUB_TOKEN }}
  #         publish_dir: ./_site